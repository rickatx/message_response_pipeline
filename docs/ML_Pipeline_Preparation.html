---

title: ML Pipeline Preparation


keywords: fastai
sidebar: home_sidebar



nb_path: "ML_Pipeline_Preparation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: ML_Pipeline_Preparation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk.stem.wordnet</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>

<span class="c1"># download nltk data</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">([</span><span class="s1">&#39;stopwords&#39;</span><span class="p">,</span> <span class="s1">&#39;wordnet&#39;</span><span class="p">,</span> <span class="s1">&#39;punkt&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>[nltk_data] Downloading package stopwords to
[nltk_data]     C:\Users\USER\AppData\Roaming\nltk_data...
[nltk_data]   Package stopwords is already up-to-date!
[nltk_data] Downloading package wordnet to
[nltk_data]     C:\Users\USER\AppData\Roaming\nltk_data...
[nltk_data]   Package wordnet is already up-to-date!
[nltk_data] Downloading package punkt to
[nltk_data]     C:\Users\USER\AppData\Roaming\nltk_data...
[nltk_data]   Package punkt is already up-to-date!
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>ls
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CleanedMessages.db
categories.csv
messages.csv
test_save.db
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;sqlite:///CleanedMessages.db&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s1">&#39;CategorizedMessages&#39;</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-Exploration">Data Exploration<a class="anchor-link" href="#Data-Exploration"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>message</th>
      <th>original</th>
      <th>genre</th>
      <th>related</th>
      <th>request</th>
      <th>offer</th>
      <th>aid_related</th>
      <th>medical_help</th>
      <th>medical_products</th>
      <th>...</th>
      <th>aid_centers</th>
      <th>other_infrastructure</th>
      <th>weather_related</th>
      <th>floods</th>
      <th>storm</th>
      <th>fire</th>
      <th>earthquake</th>
      <th>cold</th>
      <th>other_weather</th>
      <th>direct_report</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>Weather update - a cold front from Cuba that c...</td>
      <td>Un front froid se retrouve sur Cuba ce matin. ...</td>
      <td>direct</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>Is the Hurricane over or is it not over</td>
      <td>Cyclone nan fini osinon li pa fini</td>
      <td>direct</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8</td>
      <td>Looking for someone but no name</td>
      <td>Patnm, di Maryani relem pou li banm nouvel li ...</td>
      <td>direct</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 40 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 26216 entries, 0 to 26215
Data columns (total 40 columns):
 #   Column                  Non-Null Count  Dtype 
---  ------                  --------------  ----- 
 0   id                      26216 non-null  int64 
 1   message                 26216 non-null  object
 2   original                10170 non-null  object
 3   genre                   26216 non-null  object
 4   related                 26216 non-null  int64 
 5   request                 26216 non-null  int64 
 6   offer                   26216 non-null  int64 
 7   aid_related             26216 non-null  int64 
 8   medical_help            26216 non-null  int64 
 9   medical_products        26216 non-null  int64 
 10  search_and_rescue       26216 non-null  int64 
 11  security                26216 non-null  int64 
 12  military                26216 non-null  int64 
 13  child_alone             26216 non-null  int64 
 14  water                   26216 non-null  int64 
 15  food                    26216 non-null  int64 
 16  shelter                 26216 non-null  int64 
 17  clothing                26216 non-null  int64 
 18  money                   26216 non-null  int64 
 19  missing_people          26216 non-null  int64 
 20  refugees                26216 non-null  int64 
 21  death                   26216 non-null  int64 
 22  other_aid               26216 non-null  int64 
 23  infrastructure_related  26216 non-null  int64 
 24  transport               26216 non-null  int64 
 25  buildings               26216 non-null  int64 
 26  electricity             26216 non-null  int64 
 27  tools                   26216 non-null  int64 
 28  hospitals               26216 non-null  int64 
 29  shops                   26216 non-null  int64 
 30  aid_centers             26216 non-null  int64 
 31  other_infrastructure    26216 non-null  int64 
 32  weather_related         26216 non-null  int64 
 33  floods                  26216 non-null  int64 
 34  storm                   26216 non-null  int64 
 35  fire                    26216 non-null  int64 
 36  earthquake              26216 non-null  int64 
 37  cold                    26216 non-null  int64 
 38  other_weather           26216 non-null  int64 
 39  direct_report           26216 non-null  int64 
dtypes: int64(37), object(3)
memory usage: 8.0+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">genre</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>news      13054
direct    10766
social     2396
Name: genre, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check values of categorization columns.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1    19906
0     6122
2      188
Name: related, dtype: int64

0    21742
1     4474
Name: request, dtype: int64

0    26098
1      118
Name: offer, dtype: int64

0    15356
1    10860
Name: aid_related, dtype: int64

0    24132
1     2084
Name: medical_help, dtype: int64

0    24903
1     1313
Name: medical_products, dtype: int64

0    25492
1      724
Name: search_and_rescue, dtype: int64

0    25745
1      471
Name: security, dtype: int64

0    25356
1      860
Name: military, dtype: int64

0    26216
Name: child_alone, dtype: int64

0    24544
1     1672
Name: water, dtype: int64

0    23293
1     2923
Name: food, dtype: int64

0    23902
1     2314
Name: shelter, dtype: int64

0    25811
1      405
Name: clothing, dtype: int64

0    25612
1      604
Name: money, dtype: int64

0    25918
1      298
Name: missing_people, dtype: int64

0    25341
1      875
Name: refugees, dtype: int64

0    25022
1     1194
Name: death, dtype: int64

0    22770
1     3446
Name: other_aid, dtype: int64

0    24511
1     1705
Name: infrastructure_related, dtype: int64

0    25015
1     1201
Name: transport, dtype: int64

0    24883
1     1333
Name: buildings, dtype: int64

0    25684
1      532
Name: electricity, dtype: int64

0    26057
1      159
Name: tools, dtype: int64

0    25933
1      283
Name: hospitals, dtype: int64

0    26096
1      120
Name: shops, dtype: int64

0    25907
1      309
Name: aid_centers, dtype: int64

0    25065
1     1151
Name: other_infrastructure, dtype: int64

0    18919
1     7297
Name: weather_related, dtype: int64

0    24061
1     2155
Name: floods, dtype: int64

0    23773
1     2443
Name: storm, dtype: int64

0    25934
1      282
Name: fire, dtype: int64

0    23761
1     2455
Name: earthquake, dtype: int64

0    25686
1      530
Name: cold, dtype: int64

0    24840
1     1376
Name: other_weather, dtype: int64

0    21141
1     5075
Name: direct_report, dtype: int64

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Multiple-Classes-in-'related'-column">Multiple Classes in 'related' column<a class="anchor-link" href="#Multiple-Classes-in-'related'-column"> </a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see that while most columns have values in {0, 1} indicating false/true, the 'related' column has values from the set: {0, 1, 2}.</p>
<p>I didn't find documentation that explained this, so investigate further.</p>
<p>What is the character of the messages in each of the categories of the 'related' column?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">r_val</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">============= val: </span><span class="si">{r_val}</span><span class="s2"> =============&quot;</span><span class="p">)</span>
    <span class="n">sub_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">related</span><span class="o">==</span><span class="n">r_val</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">80</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sub_df</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
============= val: 1 =============
Weather update - a cold front from Cuba that could pass over Haiti
Is the Hurricane over or is it not over
Looking for someone but no name
UN reports Leogane 80-90 destroyed. Only Hospital St. Croix functioning. Needs supplies desperately.
says: west side of Haiti, rest of the country today and tonight
Storm at sacred heart of jesus
Please, we need tents and water. We are in Silo, Thank you!
I am in Croix-des-Bouquets. We have health issues. They ( workers ) are in Santo 15. ( an area in Croix-des-Bouquets )
There&#39;s nothing to eat and water, we starving and thirsty.
I am in Thomassin number 32, in the area named Pyron. I would like to have some water. Thank God we are fine, but we desperately need water. Thanks
Let&#39;s do it together, need food in Delma 75, in didine area
More information on the 4636 number in order for me to participate. ( To see if I can use it )
A Comitee in Delmas 19, Rue ( street ) Janvier, Impasse Charite #2. We have about 500 people in a temporary shelter and we are in dire need of Water, Food, Medications, Tents and Clothes. Please stop by and see us.
We need food and water in Klecin 12. We are dying of hunger. Impasse Chretien Klecin 12 extended ( extension ) We are hungry and sick.
I would like to know if the earthquake is over. Thanks
I would like to know if one of the radio ginen Journalist died?
I&#39;m in Laplaine, I am a victim
There&#39;s a lack of water in Moleya, please informed them for me.
Those people who live at Sibert need food they are hungry.
I want to say hello, my message is to let you know that there&#39;s an area in faustin Anhy street that has nothing neither food, water and medicine,
People I&#39;m at Delma 2, we don&#39;t anything what so ever, please provide us with some food, water, and medicine
We are at Gressier we needs assistance right away. ASAP, Come help us.
How can we get water and food in Fontamara 43 cite Tinante?
We need help. Carrefour has been forgotten completely. The foul odor is killing us. Just letting you know. Thanks!!
We have a lot of problem at Delma 75 Avenue Albert Jode, those people need water and food.
People have been sleeping outdoors in a field near Lilavois since 12 Jan. No coords on Lilavois but apparently it is near PaP
We want you to know that Carrefour need help, we starving to death.
How we can find food and water? we have people in many differents needs, and also for medicine at Fontamara 43 cite Tinante.
Delmas 33 in Silo, need water.
I would like to get help at Cote Plage in Carrefour
I am in Leoganes, where can I get food? Please
The Comite Miracle in the area of Alerte Rue Monseigneur Guilloux, ( Streets, Alerte and the cross street is Mgr Guilloux ) would like to urgently receive food, water and tents for the people in that area. Thanks
People from Dal blocked since Wednesday in Carrefour, we having water shortage, food and medical assistance.
In Jacmel it&#39;s not working at all, because people are dying of hunger.
We have no one everybody is dead.
We don&#39;t talk about Petit-Goave, Please, look into Petit-Goave.
Good evening, is the earthquake end?
People in Fontamara 27 in impass area Pierre Louis having lots of difficulties, please help, ASAP.
Good evening, I congratulate you for all the good work and with strenght i&#39;m listening from Matisan 1, we have water and food shortage but God provided his grace upon us.
how can we find aid and food in fontamara ( carrefour )
Am listening to radio in Jacmel. Need help to remove dead bodies at Colege la Trinite-universite, the bodies are the professors and students
People from Jacmel are requesting a tractor in that area because there is a civil unrest and social disturbance in that area.
Im asking a general prayer for the country of Haiti.
We are at KF Marotiere 85, we have food and water shortage, please send food for us.
What&#39;s up? I would like to know how the Arab is doing.
I am listening to radio wa in jacmel. I am asking for help to remove the dead bodies under La trinite college situated at university inasmo. The dead bodies are those of students and teachers
In which transfert house does someone abroad has to go to send money to haiti
For your information, There are people that are found in the rubbles of the School of Trinite, ( L&#39;Ecole Sainte Trinite ) in Jacmel. Cookies brought to them by Colombian dogs are keeping them alive.
When can we get some help in Jacmel?
How can we find help and food in fontamara 43 rue menos
SOS SOS, please provide police officers on the streets as they are very insecure
.. .. . we are here our mother has no more water. if you are there let us know ( location not provided )
People needing water with baby Location : Beach 24
help is needed in fond parisien, no idea where that is, but any haitian can tell you
We&#39;re asking for water, medical supply, food
My home is at Gressier, it has almost collapsed. I would like to distroy it before it collapses completly.
would like to know where food and water are being distributed. ( location not provided )
We are seven in the house. Located betwenn Musso and Juvenat. Dyobel-Dyobal. .. not sure The rest of the information is not clear.
He is a pastor and an interpreter seeking to help response teams.
we have problem at Paco Lazon this is General Police Department we want you to know we almost out of food and water.
We are in Sainte Bernadette. There are 2 areas that have not received anything. We are buying water ( warm ) for 5 gourdes.
I would like to communicate with my family I don I t have any minutes on my cell phone please help
some people are sleeping outside on a field at Lilavois 50 and are dying of hunger since January 12th.
Friend I dont know what is going on with you for I hear of what is going on but i have not hear any news about you. I hear what happen Carrefour and petion-Ville
i&#39;m asking for help to this valley especially Santo, Sath, B
I am a driver, a mechanic ,. I want to help
a lot and we don&#39;t have any news of him. We haven&#39;t even found a body so we could at least know he is dead. The hospitals need to be checked and the registry books also. Please help us!! ( This seems to be the end of another message )
We have a big problem in Jacmel, we left Port-au-Prince without food, clothes and money. we are really in a critical situation.
We would like to receive some help in the Section Communale. There is a lot of violence.
A cold front is found over Cuba this morning. It could cross Haiti tomorrow. Isolated rain showers are expected over our region tonight.
Please we need help, food and toiletries.
A weather forcast. . of a cold front in cuba and could pass through haiti by night..
food water mediacation, we dont have tents to protect our selves, i am using my cistern. lovation not provided
The ADJS group house in Jacmel. They are talking with people in the southeast. There are a lot of victims and people suffering, especially in Jacmel. Something about an entire house collapsing. The road sot pop in Jacmel is cut off.
This is a request that the aid services not forget the south-east region because there are a lot of victims and people suffering there. A number is given.
Where can people in Fort Mercredi can find food and water?
( im taking a guess at this sorry its a mix of creole and french. sms.) message as i understand. whos close to mounn fort mercredi  food and water is running low. because there is a problem with people hurt. please help us.
We are at Fort Mercredi ( wednesday ) where can we find tents and treated water.
whos next to fort mercredi i would like food and water please
The wounded in the Saint Michely hospital have no medicine. (This looks like part of a message that got cut off)

============= val: 0 =============
Information about the National Palace-
I would like to receive the messages, thank you
I am in Petionville. I need more information regarding 4636
are you going to call me or do you want me to call ou? let me know?
I don&#39;t understand how to use this thing 4636.
Can you tell me about this service
Good evening, Radio one please. I would like information on Tiyous.
I&#39;m here, I didn&#39;t find the person that I needed to send the pant by phone
I&#39;m listening to you at Miraguan we asking the government to take change because one gallon gas is 80.
i am very happy, i hear god, religious hyme
I would like to know how food is distributed.
I can play carnaval Anbasad Camp there I think this is a simple comment about a creole rap group - Anbasad Camp. Does not refer to location or read as a cry for help. TK
ples give us cell cards ( cell phone minuts ) we cannot find cell phone cards to buy
Whoever sees her in the streets : she was wearing a white denim skirt and a printed black t-shirt and her hair is in a cornrow do.
good people help us. god bless you and us too
Digicel let me go through, it&#39;s an emergency
Where can I find Capital Bank please?
URGENT ACTION NEEDED --this is follow up from previous SMS in regards to possible delivery... possible to deliver my baby in an other country, does not matter what it is..
Please add airtime on my phone. Thanks
City that i&#39;m near is Port-au Prince for me &#39;m at Titanyen
I don&#39;t know Rue du Muguet, Route de Desprez 7. Is there another location on the Airport Road?
We have a commitee from Santo 15 nameAjeans: Youth Association in action for a new society that was founded in September 2009, the president is..
What time will the American Embassy open tomorrow?
Is it true that the political city will held in Hinche?
in what field would you need me to speak creole. French, half english, ( MW? )
Where can I find a car to leave in?
Can someone who has a visa travel out. What can he do?
I know of an internet service in Croix des Bouquets, Falaise Street. The more important would be to open wireless zones for everyone that has laptops
Send me some minutes for my phone
Please, what can you do for us. We do not have anything.
miques, antihitamines, diapers, folic acid, antifungus, vitamin C, feminine pads, vaginal solutions, klorox, disinfectants.. 
I come back and nothing is the same my clothes are not there for me to put on
Digicel, please put some credit on our phones
The manager of digicel phone compagny sent out phone cards for his clients
I want to make a call, I can&#39;t, there is a crowd of my relatives and I cannot hear, do me a favor please
their is someone that left their home and never remembered to call their family, they will never know what happen
I was in Port-au-Prince and went to the north-west department. I want to know if internet is working in port-au-prince. Thank you. Let&#39;s keep contact
I have no card, tell me what kind of SMS I need to send
Around my house, there are no cyber cafe for me to use
so, in the message you spoke of registering names. I&#39;d like to know what purpose this serves. help me out. thank you
I am not in port au prince, I am in Limbe do you know a place where there is working Internet
no cybercafe working close to where i live
Artists that have died, those who are wounded and those whom have disappeared I will be naming them today, there are more than 6 radios like Radio One, Radio Signal Fm, Maximum Caraib Fm, Lumiere etc
Telenet Internet Cafe on Plaisance&#39;s old building space hello digicel communication
the cyber cafe that is functioning is SERVICE MATICS the address is in front of the BRASSERIE LA COURONNE.
K aTIS RAP CREOLE. CONTACT ME FAST. FAST VIA SMS OR CALL URGENT it is very very important because it today im gonna do wats I got to do over the bariers am allready waiting
there are no rooms at the mayors office that have internet access
this sms is only giving you an address not much detail. . / 2 cyber cafe route of frere. . a litle under where the jumbala night club is..
We have the internet at the Internet Cafe by Ti Place Cazeaux
MY PHONE HAS NO MINUTE CARD I CANT SEND ANY MESSAGE I WOULD NEED INTERNET I CANT CALL THE PERSON THAT COULD SEND THE MESSAGE.
cyber cafe global univercell cabaret 35 km from port au prince
i need a card to call my family.
the closest cyper cafe is express nety in croix des bouquet befog the police station. TN 4th message i translate advertising a cyper cafe
i need a litle credit on my count
I don&#39;t know the address at all because I just came from Jeremie
There&#39;s only one cybercafe in the town called MOLE
i salut you for all you are doing to help us now. this is actually for the adress of a ciper cafe that is working. i will send it later. TN we had several messages about this yesterday. i suspect this is guy is advertising that he is up and running.
The address is new life bo kay in St Fille
NET ONE WIT LATORTUE IS FUNCTIONING IN THE ZONE OF DEKAWO. FREDO NET AP F
The prices have doubled for food in Mole Saint Nicolas. A cup of Corn is 45 Gdes now.
We don&#39;t have working cyber in our region
hard because everything is sold sky high. Small rice tin can is sold for 40Gourdes 40Gourdes a roughly 1. 00 US
there&#39;s a problem with the signal which blocks transactions
GOOD DAY DIGICEL GIVE ME A CHANCE SO I CA CALL SOMEONE PLEASE
GOOD DAY! SWEETHEART I LOVE YOU FOREVER BABY
GOOD DAY DIGICEL I DONT KNOW UR WEB ADDRESS
HELLO MOM CALL ME BECAUSE I CANNOT GET THROUGH..
BRA BALANSE PLEASE THINK ABOUT ME THANK YOU IN ADVANCE
I CAN&#39;T GET THROUGH ANY OTHER PHONES BUT DIGICEL
I&#39;M IN FRONT OF THE EMBASSY CALL ME
please, which cyber cafe is in service? no other information noted within text.
can you inform me of any Transfer bureau that is currently functionning?? because i have and urgency
self eplanatory. read text msg.
Goodday, there is a cybercafe that is available on Route National #1 near the corner of Vincent
thank you for the follow up you will give this message and it is important that I tell you that I
I speak French very well, I speak Spanish very well, I speak ( no other information )
Digicel please i cannot make phone calls, see what you can do for me
what cyber cafe&#39;s are working?
send me the info for the croix des bouquets please
I am located in Route Freres- Impasse Fortin. .. A bit further than the Granit Market

============= val: 2 =============
Dans la zone de Saint Etienne la route de Jacmel est bloqu, il est trsdifficile de se rendre  Jacmel
. .. i with limited means. Certain patients come from the capital.
The internet caf Net@le that&#39;s by the Dal road by the Maranata church ( incomplete )
Bonsoir, on est a bon repos aprs la compagnie teleko sur la route a droite de l&#39;impasse Roger colas aprs la 9e maison sur la main droite de la rue, on est environ 30 personnes sur un. ..
URGENT CRECHE ORPHANAGE KAY TOUT TIMOUN CROIX DES MISSIONS IMPASSE BALEV BUTTE BOYER MANQUE EAU ET NOURRITURE N ONT VU AUCUN SECOURS DEPUIS 8 JOURS HELP HELP
elle est vraiment malade et a besoin d&#39;aide. utilisez mon numero de tlphone pour obtenir plus de renseignements. Nous attendons une reponse. Aucun numero fourni par contre.
no authority has passed by to see us. We don&#39;t have a place t sleep ( incomplete )
It&#39;s Over in Gressier. The population in the area - Incomplete
we sleep with the baby. Thanks in advance for the help you will bring us. ( incomplete )
I need help in Jrmie because I was in Port-au-Prince in university I am counting on you.
fsa pou mwen s v p map mouri mwen gen tout po blem ede m a do that for me plz. I&#39;m dying. I have all sorts of problems. Help me
.. Gonaives, in a place called Canal Bois in French. i&#39;m writing this message just to.. 
GEN YON TIBEBE KI MALAD NAN KOU PASKE BLOK TONBE SOU LI. MEN DIREKSYON AN LEW RIVE NAN VIL LEYOGAN WAP MONTE NAN WOUT DABON LEW RIVE NAN KAFOU DABON WAP VIRE NAN BO KKOTI YZIN NAN. WAP JWENN YON KAFOU LEW RIVE PIDEVAN WAP WE SANT CEFECAC LA. OUBYEN LEW NAN WOUT WAP RELEM EPI MAP PRAN YON MOTE POUM VIN CHAC 
don&#39;t understand the first part. .. understanding. We are waiting for your response
Est-ce que ya monde qui aller U. s. a et qui ont tomoin qui Americain Are there people who are going to US and that have witness that is american 
Gens ont information qui dit que si on moins citoyens americains vit ici l que tout aller ok tout le monde vite fil pour qu&#39;on essaie survivre. People have information that say that if american citizens live here that all will be ok and that everyone ( could be the world ) hurrying to try to make us survive.
This is my address : Cersine 8 Prolong. .. . 
I would like to have some information on the last disaster
No location : Ou se trouve l&#39;ambassade du Sngal en Haiti
Je veux savoir comment je peux obtenir de l&#39;aide pour mon orphelinat situ  Delmas 31, svp dites-moi ce que je dois faire
142, Ruelle Beaulieu, Mon Repos 44 Carrefour 
. ..  Esdras. Address : Solidarit Village, Toussain Louverture Street 83A!
Route des dalles prolonges #277 after Morne Jean-Pierre, thank you do. ..  
we are in rue Dessalines Petit goaves and it necessary to..? 
I am very happy to get the messages that tell me about the precautions I have to take. Thank you very much, If you could make it so that food comes my way it would be good because .. 
mouin vle kite ayiti depi kek jou. 
Mwen ta renmen jwenn yon djb. ske gen posiblite pou mwen jwenn li? Kisa ou ka f pou ede mwen? Mwen bezwen savis ou. 
(Delmas 33 Charboniere infomatyon s&#39;il vous plait.) 
Carrefour Feuille rue Mgr Prol # 39 
Ede m nan lort pou genyen yon bourss 
mwen ta renmen gen enfmasyon sou siklyn nan peyi mwen 
jel2  Acte 5: 29 2chr7 Lev11 Ecl9 Ecl4 jos5 ch102kr Es59 
I&#39;d like to know after this drama, will there be anywhere that I may see a psychologist, who maybe available because I have 
gjm.adgjmpgjm.adgjmgjmgjmgjmgjmgkmptwptwptwptwptwptwptwptwptwptwpwptwptwgjmgjmgjmad.ad.ad.ad.d.ad.d.da.d.ad.ad.ad 
are what the imigration restarts has make of them pass-port for people that not of pass-port 
mwen besoin dlo avek mange na zon bon repos, lilavois 
Damocles!Hracles!Philockles!Hyphocles.!yayecles!zigzacles!domagecles!lucles!77h  
The SMS:  Evitons 2 traiter 1 tas bLaissons 2 cot 7 kesyon. Ke tu sois direct tais notre mach conclus 2 c matin. J&#39;t&#39;attends  
Midi Estimene:rue Lambert Prolongee and rue Merilus #4 (Petion-ville) 
Amoni se Richi: Rue Raphael et Cerisier (Petion Ville) 
 9GeQYeYGQEQtm  
annot ni batiman dada cheri se pwason ni ou ni manmi w ni keti renmen an pil la wi se yon gro rat at yon gro kwapo kitap batay lasirne f tranf pou tou 
0H 8@@ @2x @e8x3 xr     
http://wap.sina.comhttp://wap.sina.com 
Wesantyahoo.fr.Pepayisenyahoo.fr 
//// // @:@ 
NOTES: this message is not complete
f k yo ap mal viv nan ansagal lagonav.msi.  
8 @9q@@  5 m) 1A a!a ?aCYCLONE  
/&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;@&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;@ @&#39;&#39;&#39;&#39;&#39; michou )) &#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;cyclone.  
I@UU#UTGa UTUUUXU  UU@UU@UUp U. 
Good evening to all parts of the United Nations so I remsiw Adra, Spain because I see something to bring 250 people found the four towels soap Cink had a six ice all very much pleased the United Nations kounya other things I&#39;m waiting for luggage next to Always on baylode. 
Pal kraze preval di pa gen pwoblem, pal jistis kraze preval di sa te dwe kraze 2ja paske pat janm gen jistis, yo di kleren lakay ak rhum barbancourt kraze preval met 2 men nan tt li rele anmwey pa gen peyi ank. 
0Tranbleman t aH 8@@ @2x @e8x3 xr    &#39; Gv?e?0   
The SMS:  Rezilta Bak la sot bay 12 Janvye a nan lekl la vi a. Men kman l tonbe: Moun ki mouri nan dezobeyisans yo: Elimine Moun ki mouri anba pouvwa Bondye yo: Admi e rs moun ki rete yo ajoune. Pa bliye egzamen moun ajoune yo p&#39;ap two lwen pou&#39;l ft, degaj  
Aa.Bb.Cc.Dd.Ee.Ff.Gg.Hh.Ii.Jj.Kk.Ll.Mm.Nn.Oo.Pp.Qq.Rr.Ss.Tt.Uu.Vv.Ww.Xx.Yy.Zz.KERLANGE. 
3 mamit chabon,4 dola poban,kart,pn 2 t,kreson,tomat. 
Mato30 Nivo60 Tiwl30 Ficel22 Ek49 
Bonjou fr Louko mwen se simon st.pierre map koute radio 1 nan boukan-chat map mandew svp pouw salye moun sayo pou mwen: Eunide Elissain, wiskender st.pierre,et jesual st.pierre,alyas pipirit, kap koute radyo a chapotin. Msi. 
2O TRI PYE, 5 POIRO, 2GD PESI, 1OMORU, 5LAY3DOLA SITWON 
Prcaussion cons of the aspen earth 
Zb rmd : dl 2, dl rep, dl chase 
Zb rmd : dl c.lve dl 2, dl rep, dl chase. 
please, we would like to know if itis true thereas in the moment. 
NOTES: This message is not complete, it is not necessary to translate it.
NOTES: This message mark not enough information.
Word Hurricane and earthquake 
Wpltjgdtm pwjtj ptjg. T .)tgjpg(uk 
Tegen tranblement land kite yon pase nan north country of haiti sete year 1842 Bulan interest unknown 
0H4Z(Z x(@zf0 ?!?@x PrxP0c6 
RT lucasrohan Tem alguma coisa do Haiti? T u00f4 acomapanhando a lista nprnews haiti earthquake t u00e1 ca u00f3tico t u00e1 um horror l u00e1
RT paipibat RT Teelek Flickr paipibat u0e15 u0e34 u0e14 u0e15 u0e32 u0e21 u0e20 u0e32 u0e1e u0e08 u0e32 u0e01 u0e40 u0e1e u0e34 u0e48 u0e21 u0e40 u0e15 u0e34 u0e21 u0e08 u0e32 u0e01 Flickr u0e44 u0e14 u0e49 u0e17 u0e35 u0e48 u0e19 u0e35 u0e48 u0e04 u0e23 u0e31 u0e1a http bit.ly 60OxGS #Haiti #Earthquake
alhamdulillah sekarang udah jarang Earthquake lagi
RT Fleegerian_Akin RT ShanCali Earthquake in carribean I feel sorry 4 dem ppl in hatti da whole island is basi cont http tl.gd 3g8mi
Haiti Earthquake Earthquake Hits Haiti C est tre tres rare que trembleme. http bit.ly 53Z4gm n Got News? Add It!
RT Contentgirls earthquake heeft mensen wel wakker gekregen maar is niet zwaar. Even benadrukken voor het geval iemand familie heeft o ..
Contentgirls gelukkig earthquake niet te zwaar Aruba Antillen. Heb jij er familie?
Gismis pallas_ploem earthquake heeft mensen wel wakker gekregen maar is niet zwaar. via Contentgirls
RT mHefneratm RT LoSoATM What happened n HaiTi ??&amp;gt Da Whole Situation turn ugly! Xhi Xhi.. Lmao Nah a earthquake! WrD! $hyT Brazzi
Cara, eu to màöâ§ tenso, quero saber se minha prima e minha tia estao bem com esse terremoto &#39;-&#39; elas moram en Santiago no Chile &amp;gt;.&amp;lt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It seems that the 'related' value is 1 if the message is related to some disaster, and 0 otherwise. Messages with 'related' val = 2 include also untranslated messages and miscellaneous garbage.</p>
<p>Let's look at the values of the other categorization columns for each of the 3 values for 'related'.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">related</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;request&#39;</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3.16693459258515</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">related</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;request&#39;</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">related</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;request&#39;</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Conclusion:</strong> Other categorization flags are on (= 1) for a row only if that row has a value of 1 for 'related'.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Prevalence-of-URLs">Prevalence of URLs<a class="anchor-link" href="#Prevalence-of-URLs"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url_regex</span> <span class="o">=</span> <span class="s1">&#39;http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="s2">&quot;Some text https://www.Udacity.coM/ more text.&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;https://www.Udacity.coM/&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="s1">&#39;no url here&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_url_msg</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">n_url_msg</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">n_url_msg</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>669</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">is_related</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">related</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">n_url_related</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">is_related</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">n_url_related</span> <span class="o">+=</span> <span class="mi">1</span>
        
<span class="n">n_url_unrelated</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">is_related</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">n_url_unrelated</span> <span class="o">+=</span> <span class="mi">1</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n_url_related=</span><span class="si">{n_url_related}</span><span class="s2">, n_url_unrelated=</span><span class="si">{n_url_unrelated}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;{100*n_url_related/df[is_related].shape[0]}%, {100*n_url_unrelated/df[~is_related].shape[0]}%&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>n_url_related=552, n_url_unrelated=117
2.7730332563046316%, 1.8541996830427891%
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The frequency of urls in related and unrelated messages are similar.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># number of unique urls</span>
<span class="n">urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
    <span class="n">urls</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 70 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>810</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">urls</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>765</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">url_counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>http://twitpic.com/16esd9                                                                                        8
http://bit.ly/a7zy8s                                                                                             7
http://twitpic.com/18deq7                                                                                        6
http://twitpic.com/16ad2g                                                                                        6
http://twitpic.com/15wu5u                                                                                        5
http://bit.ly/cs8BsY                                                                                             3
http://blip.fm/                                                                                                  3
http://bit.ly/a8pajh                                                                                             3
http://172.16.3.136/mymain2.php                                                                                  2
http://teeth.com.pk/blog                                                                                         2
http://t.co/Sq2ekENu                                                                                             2
http://bit.ly/bVYUCM                                                                                             2
http://tinyurl.com/yfbwr9e                                                                                       2
http://bit.ly/9oNfHA                                                                                             2
http://t.co/4OcLhyie                                                                                             2
http://172.16.3.136/wap/news-french.php                                                                          2
http://reliefweb.int/https://www.hrw.org/news/2013/02/01/mali-malian-army-islamist-groups-executed-prisoners)    2
http://wefollow.com                                                                                              2
http://bit.ly/9iG2mo                                                                                             2
http://t.co/Mp93XaGx                                                                                             2
http://bit.ly/cizpk8                                                                                             1
http://twitpic.com/184zzz                                                                                        1
http://t.co/7dEi6v5u                                                                                             1
http://t.co/C42U9QqDlong                                                                                         1
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Split-Data-into-Model-Input-and-Target">Split Data into Model Input and Target<a class="anchor-link" href="#Split-Data-into-Model-Input-and-Target"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Handle-'related'-column-values">Handle 'related' column values<a class="anchor-link" href="#Handle-'related'-column-values"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_2</span><span class="o">.</span><span class="n">related</span> <span class="o">=</span> <span class="n">df_2</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_2</span><span class="o">.</span><span class="n">related</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1    19906
0     6310
Name: related, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Split-Data">Split Data<a class="anchor-link" href="#Split-Data"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df_2</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">df_2</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;related&#39;</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0    Weather update - a cold front from Cuba that c...
1              Is the Hurricane over or is it not over
2                      Looking for someone but no name
Name: message, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">Y</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(26216, 36)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>related</th>
      <th>request</th>
      <th>offer</th>
      <th>aid_related</th>
      <th>medical_help</th>
      <th>medical_products</th>
      <th>search_and_rescue</th>
      <th>security</th>
      <th>military</th>
      <th>child_alone</th>
      <th>...</th>
      <th>aid_centers</th>
      <th>other_infrastructure</th>
      <th>weather_related</th>
      <th>floods</th>
      <th>storm</th>
      <th>fire</th>
      <th>earthquake</th>
      <th>cold</th>
      <th>other_weather</th>
      <th>direct_report</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 36 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="2.-Write-a-tokenization-function-to-process-your-text-data">2. Write a tokenization function to process your text data<a class="anchor-link" href="#2.-Write-a-tokenization-function-to-process-your-text-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">stop_words</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">)</span>
<span class="n">lemmatizer</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
<span class="n">url_regex</span> <span class="o">=</span> <span class="s1">&#39;http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="c1"># convert urls to url token</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="s1">&#39;zzurl&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
    
    <span class="c1"># normalize case and remove punctuation</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9]&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    
    <span class="c1"># tokenize text</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    
    <span class="c1"># lemmatize and remove stop words</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="p">[</span><span class="n">lemmatizer</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tokens</span> <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stop_words</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">tokens</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">12</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">,</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weather update - a cold front from Cuba that could pass over Haiti 
     [&#39;weather&#39;, &#39;update&#39;, &#39;cold&#39;, &#39;front&#39;, &#39;cuba&#39;, &#39;could&#39;, &#39;pas&#39;, &#39;haiti&#39;] 

Is the Hurricane over or is it not over 
     [&#39;hurricane&#39;] 

Looking for someone but no name 
     [&#39;looking&#39;, &#39;someone&#39;, &#39;name&#39;] 

UN reports Leogane 80-90 destroyed. Only Hospital St. Croix functioning. Needs supplies desperately. 
     [&#39;un&#39;, &#39;report&#39;, &#39;leogane&#39;, &#39;80&#39;, &#39;90&#39;, &#39;destroyed&#39;, &#39;hospital&#39;, &#39;st&#39;, &#39;croix&#39;, &#39;functioning&#39;, &#39;need&#39;, &#39;supply&#39;, &#39;desperately&#39;] 

says: west side of Haiti, rest of the country today and tonight 
     [&#39;say&#39;, &#39;west&#39;, &#39;side&#39;, &#39;haiti&#39;, &#39;rest&#39;, &#39;country&#39;, &#39;today&#39;, &#39;tonight&#39;] 

Information about the National Palace- 
     [&#39;information&#39;, &#39;national&#39;, &#39;palace&#39;] 

Storm at sacred heart of jesus 
     [&#39;storm&#39;, &#39;sacred&#39;, &#39;heart&#39;, &#39;jesus&#39;] 

Please, we need tents and water. We are in Silo, Thank you! 
     [&#39;please&#39;, &#39;need&#39;, &#39;tent&#39;, &#39;water&#39;, &#39;silo&#39;, &#39;thank&#39;] 

I would like to receive the messages, thank you 
     [&#39;would&#39;, &#39;like&#39;, &#39;receive&#39;, &#39;message&#39;, &#39;thank&#39;] 

I am in Croix-des-Bouquets. We have health issues. They ( workers ) are in Santo 15. ( an area in Croix-des-Bouquets ) 
     [&#39;croix&#39;, &#39;de&#39;, &#39;bouquet&#39;, &#39;health&#39;, &#39;issue&#39;, &#39;worker&#39;, &#39;santo&#39;, &#39;15&#39;, &#39;area&#39;, &#39;croix&#39;, &#39;de&#39;, &#39;bouquet&#39;] 

There&#39;s nothing to eat and water, we starving and thirsty. 
     [&#39;nothing&#39;, &#39;eat&#39;, &#39;water&#39;, &#39;starving&#39;, &#39;thirsty&#39;] 

I am in Petionville. I need more information regarding 4636 
     [&#39;petionville&#39;, &#39;need&#39;, &#39;information&#39;, &#39;regarding&#39;, &#39;4636&#39;] 

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10000</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">    &#39;</span><span class="p">,</span> <span class="n">tokenize</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>If you want to find a Job at an NGO or the Government, upload your resume at http://www.jobpaw.com/  
     [&#39;want&#39;, &#39;find&#39;, &#39;job&#39;, &#39;ngo&#39;, &#39;government&#39;, &#39;upload&#39;, &#39;resume&#39;, &#39;zzurl&#39;] 

NOTES: WHAT A JERK ,ALL HAITIANS DONT HAVE ANYTHING TO EAT ,AND &#39;&#39;HE&#39;&#39; ORDERING 3 DAYS WITHOUT FOOD LIKE SUPPORT FOR THOSE WITHOUT FOOD? http://welcome.topuertorico.org/government.shtml 
     [&#39;note&#39;, &#39;jerk&#39;, &#39;haitian&#39;, &#39;dont&#39;, &#39;anything&#39;, &#39;eat&#39;, &#39;ordering&#39;, &#39;3&#39;, &#39;day&#39;, &#39;without&#39;, &#39;food&#39;, &#39;like&#39;, &#39;support&#39;, &#39;without&#39;, &#39;food&#39;, &#39;zzurl&#39;] 

http://wap.sina.comhttp://wap.sina.com  
     [&#39;zzurl&#39;] 

Nokia.com http://ea.mobile.nokia.com/ea/graphics  
     [&#39;nokia&#39;, &#39;com&#39;, &#39;zzurl&#39;] 

BEGIN:VBKM VERSION:1.0 TITLE:Digicel Live Ha URL:http://172.16.3.136/mymain2.php BEGIN:ENV X-IRMC-URLQUOTED-PRINTABLE: InternetShortcut  URLhttp://172.16.3.136/mymain2.php END:ENV END:VBKM   
     [&#39;begin&#39;, &#39;vbkm&#39;, &#39;version&#39;, &#39;1&#39;, &#39;0&#39;, &#39;title&#39;, &#39;digicel&#39;, &#39;live&#39;, &#39;ha&#39;, &#39;url&#39;, &#39;zzurl&#39;, &#39;begin&#39;, &#39;env&#39;, &#39;x&#39;, &#39;irmc&#39;, &#39;urlquoted&#39;, &#39;printable&#39;, &#39;internetshortcut&#39;, &#39;urlzzurl&#39;, &#39;end&#39;, &#39;env&#39;, &#39;end&#39;, &#39;vbkm&#39;] 

BEGIN:VBKM VERSION:1.0 TITLE:Item3 URL:http://172.16.3.136/wap/news-french.php#item3 BEGIN:ENV X-IRMC-URLQUOTED-PRINTABLE: InternetShortcut  URLhttp://172.16.3.136/wap/news-french.php#item3 END:ENV END:VBKM  
     [&#39;begin&#39;, &#39;vbkm&#39;, &#39;version&#39;, &#39;1&#39;, &#39;0&#39;, &#39;title&#39;, &#39;item3&#39;, &#39;url&#39;, &#39;zzurl&#39;, &#39;item3&#39;, &#39;begin&#39;, &#39;env&#39;, &#39;x&#39;, &#39;irmc&#39;, &#39;urlquoted&#39;, &#39;printable&#39;, &#39;internetshortcut&#39;, &#39;urlzzurl&#39;, &#39;item3&#39;, &#39;end&#39;, &#39;env&#39;, &#39;end&#39;, &#39;vbkm&#39;] 

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="3.-Build-a-machine-learning-pipeline">3. Build a machine learning pipeline<a class="anchor-link" href="#3.-Build-a-machine-learning-pipeline"> </a></h3><p>This machine pipeline should take in the <code>message</code> column as input and output classification results on the other 36 categories in the dataset. You may find the <a href="http://scikit-learn.org/stable/modules/generated/sklearn.multioutput.MultiOutputClassifier.html">MultiOutputClassifier</a> helpful for predicting multiple target variables.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Pipeline">Pipeline<a class="anchor-link" href="#Pipeline"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfVectorizer</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.multioutput</span> <span class="kn">import</span> <span class="n">MultiOutputClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span><span class="p">,</span> <span class="n">FeatureUnion</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;text_features&#39;</span><span class="p">,</span> <span class="n">TfidfVectorizer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenize</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;rfc&#39;</span><span class="p">,</span> <span class="n">MultiOutputClassifier</span><span class="p">(</span><span class="n">RandomForestClassifier</span><span class="p">(),</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;memory&#39;: None,
 &#39;steps&#39;: [(&#39;text_features&#39;,
   TfidfVectorizer(analyzer=&#39;word&#39;, binary=False, decode_error=&#39;strict&#39;,
                   dtype=&lt;class &#39;numpy.float64&#39;&gt;, encoding=&#39;utf-8&#39;,
                   input=&#39;content&#39;, lowercase=True, max_df=1.0, max_features=None,
                   min_df=1, ngram_range=(1, 1), norm=&#39;l2&#39;, preprocessor=None,
                   smooth_idf=True, stop_words=None, strip_accents=None,
                   sublinear_tf=False, token_pattern=&#39;(?u)\\b\\w\\w+\\b&#39;,
                   tokenizer=&lt;function tokenize at 0x00000239E63684C8&gt;,
                   use_idf=True, vocabulary=None)),
  (&#39;rfc&#39;,
   MultiOutputClassifier(estimator=RandomForestClassifier(bootstrap=True,
                                                          ccp_alpha=0.0,
                                                          class_weight=None,
                                                          criterion=&#39;gini&#39;,
                                                          max_depth=None,
                                                          max_features=&#39;auto&#39;,
                                                          max_leaf_nodes=None,
                                                          max_samples=None,
                                                          min_impurity_decrease=0.0,
                                                          min_impurity_split=None,
                                                          min_samples_leaf=1,
                                                          min_samples_split=2,
                                                          min_weight_fraction_leaf=0.0,
                                                          n_estimators=100,
                                                          n_jobs=None,
                                                          oob_score=False,
                                                          random_state=None,
                                                          verbose=0,
                                                          warm_start=False),
                         n_jobs=2))],
 &#39;verbose&#39;: False,
 &#39;text_features&#39;: TfidfVectorizer(analyzer=&#39;word&#39;, binary=False, decode_error=&#39;strict&#39;,
                 dtype=&lt;class &#39;numpy.float64&#39;&gt;, encoding=&#39;utf-8&#39;,
                 input=&#39;content&#39;, lowercase=True, max_df=1.0, max_features=None,
                 min_df=1, ngram_range=(1, 1), norm=&#39;l2&#39;, preprocessor=None,
                 smooth_idf=True, stop_words=None, strip_accents=None,
                 sublinear_tf=False, token_pattern=&#39;(?u)\\b\\w\\w+\\b&#39;,
                 tokenizer=&lt;function tokenize at 0x00000239E63684C8&gt;,
                 use_idf=True, vocabulary=None),
 &#39;rfc&#39;: MultiOutputClassifier(estimator=RandomForestClassifier(bootstrap=True,
                                                        ccp_alpha=0.0,
                                                        class_weight=None,
                                                        criterion=&#39;gini&#39;,
                                                        max_depth=None,
                                                        max_features=&#39;auto&#39;,
                                                        max_leaf_nodes=None,
                                                        max_samples=None,
                                                        min_impurity_decrease=0.0,
                                                        min_impurity_split=None,
                                                        min_samples_leaf=1,
                                                        min_samples_split=2,
                                                        min_weight_fraction_leaf=0.0,
                                                        n_estimators=100,
                                                        n_jobs=None,
                                                        oob_score=False,
                                                        random_state=None,
                                                        verbose=0,
                                                        warm_start=False),
                       n_jobs=2),
 &#39;text_features__analyzer&#39;: &#39;word&#39;,
 &#39;text_features__binary&#39;: False,
 &#39;text_features__decode_error&#39;: &#39;strict&#39;,
 &#39;text_features__dtype&#39;: numpy.float64,
 &#39;text_features__encoding&#39;: &#39;utf-8&#39;,
 &#39;text_features__input&#39;: &#39;content&#39;,
 &#39;text_features__lowercase&#39;: True,
 &#39;text_features__max_df&#39;: 1.0,
 &#39;text_features__max_features&#39;: None,
 &#39;text_features__min_df&#39;: 1,
 &#39;text_features__ngram_range&#39;: (1, 1),
 &#39;text_features__norm&#39;: &#39;l2&#39;,
 &#39;text_features__preprocessor&#39;: None,
 &#39;text_features__smooth_idf&#39;: True,
 &#39;text_features__stop_words&#39;: None,
 &#39;text_features__strip_accents&#39;: None,
 &#39;text_features__sublinear_tf&#39;: False,
 &#39;text_features__token_pattern&#39;: &#39;(?u)\\b\\w\\w+\\b&#39;,
 &#39;text_features__tokenizer&#39;: &lt;function __main__.tokenize(text)&gt;,
 &#39;text_features__use_idf&#39;: True,
 &#39;text_features__vocabulary&#39;: None,
 &#39;rfc__estimator__bootstrap&#39;: True,
 &#39;rfc__estimator__ccp_alpha&#39;: 0.0,
 &#39;rfc__estimator__class_weight&#39;: None,
 &#39;rfc__estimator__criterion&#39;: &#39;gini&#39;,
 &#39;rfc__estimator__max_depth&#39;: None,
 &#39;rfc__estimator__max_features&#39;: &#39;auto&#39;,
 &#39;rfc__estimator__max_leaf_nodes&#39;: None,
 &#39;rfc__estimator__max_samples&#39;: None,
 &#39;rfc__estimator__min_impurity_decrease&#39;: 0.0,
 &#39;rfc__estimator__min_impurity_split&#39;: None,
 &#39;rfc__estimator__min_samples_leaf&#39;: 1,
 &#39;rfc__estimator__min_samples_split&#39;: 2,
 &#39;rfc__estimator__min_weight_fraction_leaf&#39;: 0.0,
 &#39;rfc__estimator__n_estimators&#39;: 100,
 &#39;rfc__estimator__n_jobs&#39;: None,
 &#39;rfc__estimator__oob_score&#39;: False,
 &#39;rfc__estimator__random_state&#39;: None,
 &#39;rfc__estimator__verbose&#39;: 0,
 &#39;rfc__estimator__warm_start&#39;: False,
 &#39;rfc__estimator&#39;: RandomForestClassifier(bootstrap=True, ccp_alpha=0.0, class_weight=None,
                        criterion=&#39;gini&#39;, max_depth=None, max_features=&#39;auto&#39;,
                        max_leaf_nodes=None, max_samples=None,
                        min_impurity_decrease=0.0, min_impurity_split=None,
                        min_samples_leaf=1, min_samples_split=2,
                        min_weight_fraction_leaf=0.0, n_estimators=100,
                        n_jobs=None, oob_score=False, random_state=None,
                        verbose=0, warm_start=False),
 &#39;rfc__n_jobs&#39;: 2}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="4.-Train-pipeline">4. Train pipeline<a class="anchor-link" href="#4.-Train-pipeline"> </a></h3><ul>
<li>Split data into train and test sets</li>
<li>Train pipeline</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">Y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Train pipeline with chosen parameters.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
pipeline.set_params(text_features__max_df=0.8,
                    text_features__min_df=2.0/10000,
                    text_features__max_features=10000,
                    rfc__estimator__n_estimators=100,
                    rfc__estimator__min_samples_split=3).fit(X_train, Y_train)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Pipeline(memory=None,
         steps=[(&#39;text_features&#39;,
                 TfidfVectorizer(analyzer=&#39;word&#39;, binary=False,
                                 decode_error=&#39;strict&#39;,
                                 dtype=&lt;class &#39;numpy.float64&#39;&gt;,
                                 encoding=&#39;utf-8&#39;, input=&#39;content&#39;,
                                 lowercase=True, max_df=0.8, max_features=10000,
                                 min_df=0.0002, ngram_range=(1, 1), norm=&#39;l2&#39;,
                                 preprocessor=None, smooth_idf=True,
                                 stop_words=None, strip_accents=None,
                                 sublinear_tf=False,
                                 t...
                                                                        ccp_alpha=0.0,
                                                                        class_weight=None,
                                                                        criterion=&#39;gini&#39;,
                                                                        max_depth=None,
                                                                        max_features=&#39;auto&#39;,
                                                                        max_leaf_nodes=None,
                                                                        max_samples=None,
                                                                        min_impurity_decrease=0.0,
                                                                        min_impurity_split=None,
                                                                        min_samples_leaf=1,
                                                                        min_samples_split=3,
                                                                        min_weight_fraction_leaf=0.0,
                                                                        n_estimators=100,
                                                                        n_jobs=None,
                                                                        oob_score=False,
                                                                        random_state=None,
                                                                        verbose=0,
                                                                        warm_start=False),
                                       n_jobs=2))],
         verbose=False)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.-Test-your-model">5. Test your model<a class="anchor-link" href="#5.-Test-your-model"> </a></h3><p>Report the f1 score, precision and recall for each output category of the dataset. You can do this by iterating through the columns and calling sklearn's <code>classification_report</code> on each.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
predicted_test = pipeline.predict(X_test)
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
col_names = Y_test.columns
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
for y_true, y_pred, colname in zip(Y_test.values.T, predicted_test.T, col_names):
    print(colname)
    print(&#39;=&#39;*len(colname))
    print(classification_report(y_true, y_pred))
    print()
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>related
=======
              precision    recall  f1-score   support

           0       0.67      0.48      0.56      1544
           1       0.85      0.93      0.89      5010

    accuracy                           0.82      6554
   macro avg       0.76      0.70      0.72      6554
weighted avg       0.81      0.82      0.81      6554


request
=======
              precision    recall  f1-score   support

           0       0.91      0.98      0.94      5456
           1       0.83      0.50      0.63      1098

    accuracy                           0.90      6554
   macro avg       0.87      0.74      0.78      6554
weighted avg       0.89      0.90      0.89      6554


offer
=====
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6530
           1       0.00      0.00      0.00        24

    accuracy                           1.00      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.99      1.00      0.99      6554


aid_related
===========
              precision    recall  f1-score   support

           0       0.80      0.82      0.81      3850
           1       0.74      0.71      0.73      2704

    accuracy                           0.78      6554
   macro avg       0.77      0.77      0.77      6554
weighted avg       0.78      0.78      0.78      6554


medical_help
============
              precision    recall  f1-score   support

           0       0.93      0.99      0.96      6056
           1       0.62      0.11      0.18       498

    accuracy                           0.93      6554
   macro avg       0.78      0.55      0.57      6554
weighted avg       0.91      0.93      0.90      6554


medical_products
================
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6231
           1       0.80      0.14      0.24       323

    accuracy                           0.96      6554
   macro avg       0.88      0.57      0.61      6554
weighted avg       0.95      0.96      0.94      6554


search_and_rescue
=================
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6373
           1       0.65      0.11      0.19       181

    accuracy                           0.97      6554
   macro avg       0.81      0.55      0.59      6554
weighted avg       0.97      0.97      0.96      6554


security
========
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6426
           1       0.00      0.00      0.00       128

    accuracy                           0.98      6554
   macro avg       0.49      0.50      0.49      6554
weighted avg       0.96      0.98      0.97      6554


military
========
              precision    recall  f1-score   support

           0       0.97      1.00      0.99      6357
           1       0.64      0.14      0.23       197

    accuracy                           0.97      6554
   macro avg       0.81      0.57      0.61      6554
weighted avg       0.96      0.97      0.96      6554


child_alone
===========
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6554

    accuracy                           1.00      6554
   macro avg       1.00      1.00      1.00      6554
weighted avg       1.00      1.00      1.00      6554


water
=====
              precision    recall  f1-score   support

           0       0.97      1.00      0.98      6168
           1       0.86      0.47      0.61       386

    accuracy                           0.96      6554
   macro avg       0.91      0.73      0.79      6554
weighted avg       0.96      0.96      0.96      6554
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\USER\anaconda3\envs\jptrlab-pip\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>

food
====
              precision    recall  f1-score   support

           0       0.97      0.98      0.97      5833
           1       0.80      0.72      0.76       721

    accuracy                           0.95      6554
   macro avg       0.88      0.85      0.87      6554
weighted avg       0.95      0.95      0.95      6554


shelter
=======
              precision    recall  f1-score   support

           0       0.95      0.99      0.97      6004
           1       0.81      0.48      0.60       550

    accuracy                           0.95      6554
   macro avg       0.88      0.73      0.79      6554
weighted avg       0.94      0.95      0.94      6554


clothing
========
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6451
           1       0.84      0.20      0.33       103

    accuracy                           0.99      6554
   macro avg       0.91      0.60      0.66      6554
weighted avg       0.99      0.99      0.98      6554


money
=====
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6398
           1       0.75      0.04      0.07       156

    accuracy                           0.98      6554
   macro avg       0.86      0.52      0.53      6554
weighted avg       0.97      0.98      0.97      6554


missing_people
==============
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6470
           1       1.00      0.05      0.09        84

    accuracy                           0.99      6554
   macro avg       0.99      0.52      0.54      6554
weighted avg       0.99      0.99      0.98      6554


refugees
========
              precision    recall  f1-score   support

           0       0.97      1.00      0.98      6333
           1       0.61      0.10      0.17       221

    accuracy                           0.97      6554
   macro avg       0.79      0.55      0.58      6554
weighted avg       0.96      0.97      0.96      6554


death
=====
              precision    recall  f1-score   support

           0       0.97      1.00      0.98      6269
           1       0.84      0.28      0.42       285

    accuracy                           0.97      6554
   macro avg       0.90      0.64      0.70      6554
weighted avg       0.96      0.97      0.96      6554


other_aid
=========
              precision    recall  f1-score   support

           0       0.87      0.99      0.93      5653
           1       0.57      0.05      0.10       901

    accuracy                           0.86      6554
   macro avg       0.72      0.52      0.51      6554
weighted avg       0.83      0.86      0.81      6554


infrastructure_related
======================
              precision    recall  f1-score   support

           0       0.93      1.00      0.97      6117
           1       0.00      0.00      0.00       437

    accuracy                           0.93      6554
   macro avg       0.47      0.50      0.48      6554
weighted avg       0.87      0.93      0.90      6554


transport
=========
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6254
           1       0.70      0.12      0.21       300

    accuracy                           0.96      6554
   macro avg       0.83      0.56      0.59      6554
weighted avg       0.95      0.96      0.94      6554


buildings
=========
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6221
           1       0.78      0.19      0.31       333

    accuracy                           0.96      6554
   macro avg       0.87      0.59      0.64      6554
weighted avg       0.95      0.96      0.94      6554


electricity
===========
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6403
           1       0.67      0.01      0.03       151

    accuracy                           0.98      6554
   macro avg       0.82      0.51      0.51      6554
weighted avg       0.97      0.98      0.97      6554


tools
=====
              precision    recall  f1-score   support

           0       0.99      1.00      1.00      6504
           1       0.00      0.00      0.00        50

    accuracy                           0.99      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.98      0.99      0.99      6554


hospitals
=========
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6476
           1       0.00      0.00      0.00        78

    accuracy                           0.99      6554
   macro avg       0.49      0.50      0.50      6554
weighted avg       0.98      0.99      0.98      6554


shops
=====
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6527
           1       0.00      0.00      0.00        27

    accuracy                           1.00      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.99      1.00      0.99      6554


aid_centers
===========
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6473
           1       0.00      0.00      0.00        81

    accuracy                           0.99      6554
   macro avg       0.49      0.50      0.50      6554
weighted avg       0.98      0.99      0.98      6554


other_infrastructure
====================
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6264
           1       0.00      0.00      0.00       290

    accuracy                           0.95      6554
   macro avg       0.48      0.50      0.49      6554
weighted avg       0.91      0.95      0.93      6554


weather_related
===============
              precision    recall  f1-score   support

           0       0.90      0.94      0.92      4667
           1       0.84      0.73      0.78      1887

    accuracy                           0.88      6554
   macro avg       0.87      0.84      0.85      6554
weighted avg       0.88      0.88      0.88      6554


floods
======
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6034
           1       0.90      0.53      0.67       520

    accuracy                           0.96      6554
   macro avg       0.93      0.76      0.82      6554
weighted avg       0.96      0.96      0.95      6554


storm
=====
              precision    recall  f1-score   support

           0       0.96      0.98      0.97      5927
           1       0.75      0.63      0.69       627

    accuracy                           0.94      6554
   macro avg       0.86      0.80      0.83      6554
weighted avg       0.94      0.94      0.94      6554


fire
====
              precision    recall  f1-score   support

           0       0.99      1.00      1.00      6491
           1       1.00      0.11      0.20        63

    accuracy                           0.99      6554
   macro avg       1.00      0.56      0.60      6554
weighted avg       0.99      0.99      0.99      6554


earthquake
==========
              precision    recall  f1-score   support

           0       0.98      0.99      0.98      5881
           1       0.89      0.82      0.86       673

    accuracy                           0.97      6554
   macro avg       0.94      0.91      0.92      6554
weighted avg       0.97      0.97      0.97      6554


cold
====
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6442
           1       0.69      0.20      0.31       112

    accuracy                           0.98      6554
   macro avg       0.84      0.60      0.65      6554
weighted avg       0.98      0.98      0.98      6554


other_weather
=============
              precision    recall  f1-score   support

           0       0.95      1.00      0.97      6176
           1       0.49      0.06      0.10       378

    accuracy                           0.94      6554
   macro avg       0.72      0.53      0.54      6554
weighted avg       0.92      0.94      0.92      6554


direct_report
=============
              precision    recall  f1-score   support

           0       0.86      0.98      0.92      5257
           1       0.81      0.37      0.50      1297

    accuracy                           0.86      6554
   macro avg       0.84      0.67      0.71      6554
weighted avg       0.85      0.86      0.84      6554


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6.-Improve-your-model">6. Improve your model<a class="anchor-link" href="#6.-Improve-your-model"> </a></h3><p>Use grid search to find better parameters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Explore-values-for-ngram-and-max_features">Explore values for ngram and max_features<a class="anchor-link" href="#Explore-values-for-ngram-and-max_features"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cv_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;text_features__ngram_range&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
    <span class="s1">&#39;text_features__max_df&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,),</span> <span class="c1">#(0.5, 0.75, 1.0),</span>
    <span class="s1">&#39;text_features__max_features&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="c1">#(5000, 10000, None),</span>
    <span class="s1">&#39;text_features__use_idf&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,),</span> <span class="c1"># (True, False),</span>
    <span class="s1">&#39;rfc__estimator__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="c1"># [50, 100, 200],</span>
    <span class="s1">&#39;rfc__estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="c1"># [2, 3, 4]</span>
<span class="p">}</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">cv_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
%%time
cv.fit(X_train, Y_train)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 1h 1min 47s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv=None, error_score=nan,
             estimator=Pipeline(memory=None,
                                steps=[(&#39;text_features&#39;,
                                        TfidfVectorizer(analyzer=&#39;word&#39;,
                                                        binary=False,
                                                        decode_error=&#39;strict&#39;,
                                                        dtype=&lt;class &#39;numpy.float64&#39;&gt;,
                                                        encoding=&#39;utf-8&#39;,
                                                        input=&#39;content&#39;,
                                                        lowercase=True,
                                                        max_df=0.8,
                                                        max_features=10000,
                                                        min_df=0.0002,
                                                        ngram_range=(1, 1),
                                                        norm=&#39;l2&#39;,
                                                        preprocessor=None,
                                                        smooth_idf=True,
                                                        stop_wor...
             iid=&#39;deprecated&#39;, n_jobs=None,
             param_grid={&#39;rfc__estimator__min_samples_split&#39;: [3],
                         &#39;rfc__estimator__n_estimators&#39;: [100],
                         &#39;text_features__max_df&#39;: (0.8,),
                         &#39;text_features__max_features&#39;: (10000, None),
                         &#39;text_features__ngram_range&#39;: ((1, 1), (1, 2)),
                         &#39;text_features__use_idf&#39;: (True,)},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
cv.best_params_
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;rfc__estimator__min_samples_split&#39;: 3,
 &#39;rfc__estimator__n_estimators&#39;: 100,
 &#39;text_features__max_df&#39;: 0.8,
 &#39;text_features__max_features&#39;: None,
 &#39;text_features__ngram_range&#39;: (1, 2),
 &#39;text_features__use_idf&#39;: True}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
pd.DataFrame(cv.cv_results_)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_rfc__estimator__min_samples_split</th>
      <th>param_rfc__estimator__n_estimators</th>
      <th>param_text_features__max_df</th>
      <th>param_text_features__max_features</th>
      <th>param_text_features__ngram_range</th>
      <th>param_text_features__use_idf</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>split2_test_score</th>
      <th>split3_test_score</th>
      <th>split4_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>149.089800</td>
      <td>2.333451</td>
      <td>11.227994</td>
      <td>0.461426</td>
      <td>3</td>
      <td>100</td>
      <td>0.8</td>
      <td>10000</td>
      <td>(1, 1)</td>
      <td>True</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.290364</td>
      <td>0.289855</td>
      <td>0.277467</td>
      <td>0.281790</td>
      <td>0.268820</td>
      <td>0.281659</td>
      <td>0.008067</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>161.480633</td>
      <td>1.983064</td>
      <td>11.380506</td>
      <td>0.100678</td>
      <td>3</td>
      <td>100</td>
      <td>0.8</td>
      <td>10000</td>
      <td>(1, 2)</td>
      <td>True</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.298500</td>
      <td>0.293415</td>
      <td>0.280010</td>
      <td>0.286368</td>
      <td>0.276195</td>
      <td>0.286898</td>
      <td>0.008238</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>147.773228</td>
      <td>1.111228</td>
      <td>10.908775</td>
      <td>0.320882</td>
      <td>3</td>
      <td>100</td>
      <td>0.8</td>
      <td>None</td>
      <td>(1, 1)</td>
      <td>True</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.294940</td>
      <td>0.291889</td>
      <td>0.274161</td>
      <td>0.288657</td>
      <td>0.263733</td>
      <td>0.282676</td>
      <td>0.011852</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>181.596993</td>
      <td>11.550008</td>
      <td>13.276466</td>
      <td>2.423728</td>
      <td>3</td>
      <td>100</td>
      <td>0.8</td>
      <td>None</td>
      <td>(1, 2)</td>
      <td>True</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.299263</td>
      <td>0.302059</td>
      <td>0.284842</td>
      <td>0.293489</td>
      <td>0.277213</td>
      <td>0.291373</td>
      <td>0.009210</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Explore-parameter-values-for-max_df">Explore parameter values for max_df<a class="anchor-link" href="#Explore-parameter-values-for-max_df"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cv_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;text_features__ngram_range&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s1">&#39;text_features__max_df&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="c1">#(0.5, 0.75, 1.0),</span>
    <span class="s1">&#39;text_features__max_features&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,),</span> <span class="c1">#(5000, 10000, None),</span>
    <span class="s1">&#39;rfc__estimator__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="c1"># [50, 100, 200],</span>
    <span class="s1">&#39;rfc__estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># [2, 3, 4]</span>
<span class="p">}</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">cv_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
%%time
cv.fit(X_train, Y_train)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 30min 55s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv=3, error_score=nan,
             estimator=Pipeline(memory=None,
                                steps=[(&#39;text_features&#39;,
                                        TfidfVectorizer(analyzer=&#39;word&#39;,
                                                        binary=False,
                                                        decode_error=&#39;strict&#39;,
                                                        dtype=&lt;class &#39;numpy.float64&#39;&gt;,
                                                        encoding=&#39;utf-8&#39;,
                                                        input=&#39;content&#39;,
                                                        lowercase=True,
                                                        max_df=0.8,
                                                        max_features=10000,
                                                        min_df=0.0002,
                                                        ngram_range=(1, 1),
                                                        norm=&#39;l2&#39;,
                                                        preprocessor=None,
                                                        smooth_idf=True,
                                                        stop_words=...
                                                                                               warm_start=False),
                                                              n_jobs=2))],
                                verbose=False),
             iid=&#39;deprecated&#39;, n_jobs=None,
             param_grid={&#39;rfc__estimator__min_samples_split&#39;: [3],
                         &#39;rfc__estimator__n_estimators&#39;: [100],
                         &#39;text_features__max_df&#39;: (0.8, 0.9, 1.0),
                         &#39;text_features__max_features&#39;: (None,),
                         &#39;text_features__ngram_range&#39;: ((1, 2),)},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
cv.best_params_
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;rfc__estimator__min_samples_split&#39;: 3,
 &#39;rfc__estimator__n_estimators&#39;: 100,
 &#39;text_features__max_df&#39;: 1.0,
 &#39;text_features__max_features&#39;: None,
 &#39;text_features__ngram_range&#39;: (1, 2)}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
pd.DataFrame(cv.cv_results_)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_rfc__estimator__min_samples_split</th>
      <th>param_rfc__estimator__n_estimators</th>
      <th>param_text_features__max_df</th>
      <th>param_text_features__max_features</th>
      <th>param_text_features__ngram_range</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>split2_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>144.819614</td>
      <td>6.677293</td>
      <td>16.512791</td>
      <td>0.834994</td>
      <td>3</td>
      <td>100</td>
      <td>0.8</td>
      <td>None</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.287611</td>
      <td>0.285627</td>
      <td>0.276625</td>
      <td>0.283288</td>
      <td>0.004780</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>156.813878</td>
      <td>13.763455</td>
      <td>16.579252</td>
      <td>0.697900</td>
      <td>3</td>
      <td>100</td>
      <td>0.9</td>
      <td>None</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.288526</td>
      <td>0.290510</td>
      <td>0.276167</td>
      <td>0.285068</td>
      <td>0.006345</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>157.639427</td>
      <td>4.676143</td>
      <td>17.892474</td>
      <td>1.905811</td>
      <td>3</td>
      <td>100</td>
      <td>1</td>
      <td>None</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.289136</td>
      <td>0.287305</td>
      <td>0.278761</td>
      <td>0.285068</td>
      <td>0.004522</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Explore-parameter-values-for-random-forest">Explore parameter values for random forest<a class="anchor-link" href="#Explore-parameter-values-for-random-forest"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cv_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;text_features__ngram_range&#39;</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),),</span>
    <span class="s1">&#39;rfc__estimator__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="c1"># [50, 100, 200],</span>
    <span class="s1">&#39;rfc__estimator__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="c1"># [2, 3, 4]</span>
<span class="p">}</span>

<span class="n">cv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">cv_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
%%time
cv.fit(X_train, Y_train)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Wall time: 1h 51min 59s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GridSearchCV(cv=3, error_score=nan,
             estimator=Pipeline(memory=None,
                                steps=[(&#39;text_features&#39;,
                                        TfidfVectorizer(analyzer=&#39;word&#39;,
                                                        binary=False,
                                                        decode_error=&#39;strict&#39;,
                                                        dtype=&lt;class &#39;numpy.float64&#39;&gt;,
                                                        encoding=&#39;utf-8&#39;,
                                                        input=&#39;content&#39;,
                                                        lowercase=True,
                                                        max_df=1.0,
                                                        max_features=None,
                                                        min_df=1,
                                                        ngram_range=(1, 1),
                                                        norm=&#39;l2&#39;,
                                                        preprocessor=None,
                                                        smooth_idf=True,
                                                        stop_words=None,
                                                        s...
                                                                                               n_estimators=100,
                                                                                               n_jobs=None,
                                                                                               oob_score=False,
                                                                                               random_state=None,
                                                                                               verbose=0,
                                                                                               warm_start=False),
                                                              n_jobs=2))],
                                verbose=False),
             iid=&#39;deprecated&#39;, n_jobs=None,
             param_grid={&#39;rfc__estimator__min_samples_split&#39;: [3, 4],
                         &#39;rfc__estimator__n_estimators&#39;: [100, 150],
                         &#39;text_features__ngram_range&#39;: ((1, 2),)},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=None, verbose=0)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
pd.DataFrame(cv.cv_results_)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_rfc__estimator__min_samples_split</th>
      <th>param_rfc__estimator__n_estimators</th>
      <th>param_text_features__ngram_range</th>
      <th>params</th>
      <th>split0_test_score</th>
      <th>split1_test_score</th>
      <th>split2_test_score</th>
      <th>mean_test_score</th>
      <th>std_test_score</th>
      <th>rank_test_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>351.798884</td>
      <td>8.290344</td>
      <td>20.927846</td>
      <td>0.190404</td>
      <td>3</td>
      <td>100</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.251755</td>
      <td>0.256332</td>
      <td>0.267470</td>
      <td>0.258519</td>
      <td>0.006600</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>524.421279</td>
      <td>10.989128</td>
      <td>29.991192</td>
      <td>0.316006</td>
      <td>3</td>
      <td>150</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 3, 'rfc_...</td>
      <td>0.257400</td>
      <td>0.263656</td>
      <td>0.268843</td>
      <td>0.263300</td>
      <td>0.004679</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>320.557537</td>
      <td>6.102964</td>
      <td>20.622887</td>
      <td>0.190247</td>
      <td>4</td>
      <td>100</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 4, 'rfc_...</td>
      <td>0.253128</td>
      <td>0.257553</td>
      <td>0.262740</td>
      <td>0.257807</td>
      <td>0.003928</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>529.091756</td>
      <td>38.520307</td>
      <td>45.809671</td>
      <td>22.776831</td>
      <td>4</td>
      <td>150</td>
      <td>(1, 2)</td>
      <td>{'rfc__estimator__min_samples_split': 4, 'rfc_...</td>
      <td>0.252212</td>
      <td>0.266555</td>
      <td>0.270980</td>
      <td>0.263249</td>
      <td>0.008010</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="7.-Test-your-model">7. Test your model<a class="anchor-link" href="#7.-Test-your-model"> </a></h3><p>Show the accuracy, precision, and recall of the tuned model.</p>
<p>Since this project focuses on code quality, process, and  pipelines, there is no minimum performance metric needed to pass. However, make sure to fine tune your models for accuracy, precision and recall to make your project stand out - especially for your portfolio!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">multioutput_classification_report</span><span class="p">(</span><span class="n">trained_model</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print a classification report for each of the outputs of a multioutput classification model.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">     - trained_model: has a predict() method</span>
<span class="sd">     - x_test: model inputs from the test set</span>
<span class="sd">     - y_test: model outputs from the test set (a dataframe with columns naming the outputs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">trained_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    <span class="n">col_names</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">columns</span>
    
    <span class="k">for</span> <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">colname</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">predicted</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">col_names</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">colname</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="k">script</span> echo skipping cell
multioutput_classification_report(cv, X_test, Y_test)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>related
=======
              precision    recall  f1-score   support

           0       0.69      0.46      0.56      1603
           1       0.84      0.93      0.89      4951

    accuracy                           0.82      6554
   macro avg       0.77      0.70      0.72      6554
weighted avg       0.81      0.82      0.81      6554


request
=======
              precision    recall  f1-score   support

           0       0.91      0.98      0.94      5470
           1       0.81      0.50      0.62      1084

    accuracy                           0.90      6554
   macro avg       0.86      0.74      0.78      6554
weighted avg       0.89      0.90      0.89      6554


offer
=====
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6525
           1       0.00      0.00      0.00        29

    accuracy                           1.00      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.99      1.00      0.99      6554


aid_related
===========
              precision    recall  f1-score   support

           0       0.80      0.86      0.83      3872
           1       0.77      0.69      0.73      2682

    accuracy                           0.79      6554
   macro avg       0.78      0.77      0.78      6554
weighted avg       0.79      0.79      0.79      6554


medical_help
============
              precision    recall  f1-score   support

           0       0.93      1.00      0.96      6045
           1       0.67      0.07      0.13       509

    accuracy                           0.93      6554
   macro avg       0.80      0.53      0.54      6554
weighted avg       0.91      0.93      0.90      6554


medical_products
================
              precision    recall  f1-score   support

           0       0.95      1.00      0.98      6217
           1       0.78      0.11      0.19       337

    accuracy                           0.95      6554
   macro avg       0.87      0.55      0.58      6554
weighted avg       0.94      0.95      0.94      6554


search_and_rescue
=================
              precision    recall  f1-score   support

           0       0.97      1.00      0.99      6366
           1       0.84      0.09      0.15       188

    accuracy                           0.97      6554
   macro avg       0.91      0.54      0.57      6554
weighted avg       0.97      0.97      0.96      6554


security
========
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6429
           1       0.00      0.00      0.00       125

    accuracy                           0.98      6554
   macro avg       0.49      0.50      0.50      6554
weighted avg       0.96      0.98      0.97      6554


military
========
              precision    recall  f1-score   support

           0       0.97      1.00      0.98      6343
           1       0.60      0.03      0.05       211

    accuracy                           0.97      6554
   macro avg       0.78      0.51      0.52      6554
weighted avg       0.96      0.97      0.95      6554


child_alone
===========
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6554

    accuracy                           1.00      6554
   macro avg       1.00      1.00      1.00      6554
weighted avg       1.00      1.00      1.00      6554


water
=====
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6134
           1       0.85      0.42      0.56       420

    accuracy                           0.96      6554
   macro avg       0.91      0.71      0.77      6554
weighted avg       0.95      0.96      0.95      6554


food
====
              precision    recall  f1-score   support

           0       0.95      0.99      0.97      5814
           1       0.84      0.61      0.70       740

    accuracy                           0.94      6554
   macro avg       0.89      0.80      0.84      6554
weighted avg       0.94      0.94      0.94      6554


shelter
=======
              precision    recall  f1-score   support

           0       0.94      0.99      0.96      5957
           1       0.83      0.34      0.48       597

    accuracy                           0.93      6554
   macro avg       0.88      0.66      0.72      6554
weighted avg       0.93      0.93      0.92      6554


clothing
========
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6447
           1       0.83      0.09      0.17       107

    accuracy                           0.98      6554
   macro avg       0.91      0.55      0.58      6554
weighted avg       0.98      0.98      0.98      6554


money
=====
              precision    recall  f1-score   support

           0       0.97      1.00      0.99      6382
           1       0.86      0.03      0.07       172

    accuracy                           0.97      6554
   macro avg       0.92      0.52      0.53      6554
weighted avg       0.97      0.97      0.96      6554
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\USER\anaconda3\envs\jptrlab-pip\lib\site-packages\sklearn\metrics\_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>

missing_people
==============
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6468
           1       1.00      0.01      0.02        86

    accuracy                           0.99      6554
   macro avg       0.99      0.51      0.51      6554
weighted avg       0.99      0.99      0.98      6554


refugees
========
              precision    recall  f1-score   support

           0       0.97      1.00      0.98      6327
           1       0.91      0.04      0.08       227

    accuracy                           0.97      6554
   macro avg       0.94      0.52      0.53      6554
weighted avg       0.96      0.97      0.95      6554


death
=====
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6270
           1       0.87      0.19      0.31       284

    accuracy                           0.96      6554
   macro avg       0.92      0.59      0.65      6554
weighted avg       0.96      0.96      0.95      6554


other_aid
=========
              precision    recall  f1-score   support

           0       0.88      1.00      0.93      5732
           1       0.55      0.03      0.05       822

    accuracy                           0.88      6554
   macro avg       0.71      0.51      0.49      6554
weighted avg       0.84      0.88      0.82      6554


infrastructure_related
======================
              precision    recall  f1-score   support

           0       0.93      1.00      0.97      6121
           1       0.15      0.00      0.01       433

    accuracy                           0.93      6554
   macro avg       0.54      0.50      0.49      6554
weighted avg       0.88      0.93      0.90      6554


transport
=========
              precision    recall  f1-score   support

           0       0.95      1.00      0.98      6238
           1       0.86      0.04      0.07       316

    accuracy                           0.95      6554
   macro avg       0.91      0.52      0.52      6554
weighted avg       0.95      0.95      0.93      6554


buildings
=========
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6224
           1       0.77      0.17      0.27       330

    accuracy                           0.96      6554
   macro avg       0.87      0.58      0.63      6554
weighted avg       0.95      0.96      0.94      6554


electricity
===========
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6422
           1       0.50      0.02      0.04       132

    accuracy                           0.98      6554
   macro avg       0.74      0.51      0.52      6554
weighted avg       0.97      0.98      0.97      6554


tools
=====
              precision    recall  f1-score   support

           0       0.99      1.00      1.00      6517
           1       0.00      0.00      0.00        37

    accuracy                           0.99      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.99      0.99      0.99      6554


hospitals
=========
              precision    recall  f1-score   support

           0       0.99      1.00      1.00      6490
           1       0.00      0.00      0.00        64

    accuracy                           0.99      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.98      0.99      0.99      6554


shops
=====
              precision    recall  f1-score   support

           0       1.00      1.00      1.00      6523
           1       0.00      0.00      0.00        31

    accuracy                           1.00      6554
   macro avg       0.50      0.50      0.50      6554
weighted avg       0.99      1.00      0.99      6554


aid_centers
===========
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6463
           1       0.00      0.00      0.00        91

    accuracy                           0.99      6554
   macro avg       0.49      0.50      0.50      6554
weighted avg       0.97      0.99      0.98      6554


other_infrastructure
====================
              precision    recall  f1-score   support

           0       0.96      1.00      0.98      6261
           1       0.00      0.00      0.00       293

    accuracy                           0.95      6554
   macro avg       0.48      0.50      0.49      6554
weighted avg       0.91      0.95      0.93      6554


weather_related
===============
              precision    recall  f1-score   support

           0       0.88      0.96      0.92      4738
           1       0.87      0.65      0.74      1816

    accuracy                           0.87      6554
   macro avg       0.87      0.80      0.83      6554
weighted avg       0.87      0.87      0.87      6554


floods
======
              precision    recall  f1-score   support

           0       0.95      1.00      0.97      6016
           1       0.91      0.41      0.57       538

    accuracy                           0.95      6554
   macro avg       0.93      0.71      0.77      6554
weighted avg       0.95      0.95      0.94      6554


storm
=====
              precision    recall  f1-score   support

           0       0.94      0.99      0.96      5950
           1       0.79      0.36      0.49       604

    accuracy                           0.93      6554
   macro avg       0.86      0.68      0.73      6554
weighted avg       0.92      0.93      0.92      6554


fire
====
              precision    recall  f1-score   support

           0       0.99      1.00      0.99      6486
           1       0.50      0.01      0.03        68

    accuracy                           0.99      6554
   macro avg       0.74      0.51      0.51      6554
weighted avg       0.98      0.99      0.98      6554


earthquake
==========
              precision    recall  f1-score   support

           0       0.98      0.99      0.98      5934
           1       0.90      0.79      0.84       620

    accuracy                           0.97      6554
   macro avg       0.94      0.89      0.91      6554
weighted avg       0.97      0.97      0.97      6554


cold
====
              precision    recall  f1-score   support

           0       0.98      1.00      0.99      6429
           1       0.44      0.03      0.06       125

    accuracy                           0.98      6554
   macro avg       0.71      0.52      0.52      6554
weighted avg       0.97      0.98      0.97      6554


other_weather
=============
              precision    recall  f1-score   support

           0       0.95      1.00      0.98      6236
           1       0.61      0.05      0.10       318

    accuracy                           0.95      6554
   macro avg       0.78      0.53      0.54      6554
weighted avg       0.94      0.95      0.93      6554


direct_report
=============
              precision    recall  f1-score   support

           0       0.87      0.98      0.92      5321
           1       0.79      0.38      0.51      1233

    accuracy                           0.86      6554
   macro avg       0.83      0.68      0.72      6554
weighted avg       0.86      0.86      0.84      6554


</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="8.-Try-improving-your-model-further.-Here-are-a-few-ideas:">8. Try improving your model further. Here are a few ideas:<a class="anchor-link" href="#8.-Try-improving-your-model-further.-Here-are-a-few-ideas:"> </a></h3><ul>
<li>try other machine learning algorithms</li>
<li>add other features besides the TF-IDF</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="9.-Export-your-model-as-a-pickle-file">9. Export your model as a pickle file<a class="anchor-link" href="#9.-Export-your-model-as-a-pickle-file"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="10.-Use-this-notebook-to-complete-train.py">10. Use this notebook to complete <code>train.py</code><a class="anchor-link" href="#10.-Use-this-notebook-to-complete-train.py"> </a></h3><p>Use the template file attached in the Resources folder to write a script that runs the steps above to create a database and export a model based on a new dataset specified by the user.</p>

</div>
</div>
</div>
</div>
 

